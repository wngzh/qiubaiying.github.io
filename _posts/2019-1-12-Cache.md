---
layout:     post
title:      Cache简述
subtitle:   一篇关于Cache的水文
date:       2019-01-28
author:     Wngzh
header-img: 'img/post-bg-rwd.jpg'
catalog: true
tags:
    - CPU
---

## 概述

&emsp;&emsp;在CPU发展中，除了优化指令流水线提高指令的运行效率之外，另一种提高CPU处理速度的思路则是分级存储，通过增加缓存（Cache），来提高对存储器的访问速度，减少读写造成的时间等待。从486处理器，就开始使用片上Cache了。因为随着CPU的发展，现在速度已经远远高于DRAM结构的主存储器，而对于SRAM来说，速度远远高于DRAM，但是成本非常高昂。对于SRAM来说，单位容量的价格大约是DRAM的数百倍，而DRAM的价格是磁盘的数百倍，速度是磁盘数十万倍。

&emsp;&emsp;在程序执行过程中，适用于这样一种局部性原理：如果某个数据项被访问，在不久的时间之内将会被再次访问，并且在这个数据周围的数据项，往往与数据相关，也很与可能被用到。这分别被称为是时间的局部性和空间的局部性。利用这个原理，可以将计算机存储设备进行分级。最靠近CPU一级被是基于SRAM的Cache，然后是DRAM组成的主存，最低一级则是磁盘。利用局部性原理，将可能用到的数据项提前从低级的慢速存储器搬移到高层次的存储器，就能实现提高存储器访问速度的效果。但是对于数据搬移的策略，涉及到命中率的问题。如果CPU能够在最高级的Cache中找到需要的数据，那么就实现了Cache的命中，如果没有命中，则发生了缓存缺失，就要付出一定的缺失代价，需要耗费较多的时间将下层的数据逐级搬移到上层的Cache中。一般来说现在的X86 CPU中都有三级Cache，典型的一个数值（正在使用的电脑）是L1 Cache 265KB，L2 Cache 1MB，L3Cache 8MB，三级的命中率能够达到90%以上。逐级增大的Cache可以在上层Cache被使用时在下层制定一些策略来减少缓存缺失的发生。Cache分为数据Cache和指令Cache等，使用合理的Cache管理策略可以大大的提升CPU的读写效率。

<div align="center">![avatar](/img/Pentium_M_Die.jpg) 
Pentium M Die， 可以看见一般的面积都分配给了L2 Cache </div>